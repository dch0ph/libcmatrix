
This release of libcmatrix is intended to work with any Unix-derived operating system and an ANSI C++ compiler.  That said, the heavy use of complex templates means that not all compilers are up to the job...

g++ V3.4 or V4 are strongly recommended.  libcmatrix does push C++ templates to their limit (though not beyond the ANSI standard).  Unfortunately some compilers don't cope well with this e.g. g++ V3.3 incorrectly reports a "ambiguous class template" error.

The configure script will almost certainly need tweaking for other compilers / Unices.  

Windows:
The library will always compile under Cygwin and should compile under the more restricted MingW environment (specify -mno-cygwin to gcc).  The MingW version is actually recommended as there seems to a large overhead associated with the C++ exception handling under Cygwin.

N.B. There appears to a compiler bug affecting gcc 3.4 under Cygwin; try turning down optimisation to -O1 if unexpected core dumps are encountered


1. Configuration
./configure
will run the autoconf script which creates Makefile, config.h, Makefile_template and test/Makefile
as a function of the system configuration.  Rather than tinker with the Makefiles produced, you should alter
compiler flags etc. by passing environment variables to configure e.g.
 setenv CXXFLAGS -g +w2
to set C++ compiler options (csh).  For the Bourne shell and variants use something like
CXX=g++ CXXFLAGS="-g +w2" ./configure
  
Recommended options (for optimisation):
g++: -g -O3  [-W -Wno-sign-compare options are added automatically if gcc is being used ]

Optional components:

"--with-atlas" on the configure command line enables use of the ATLAS
libraries for fast matrix multiplication etc. (recommended if, but only if,
dealing with relatively large spin systems).  By default, ATLAS is included if
it can found.  Use "--without-atlas" to explicitly disable ATLAS.

The location of the header and library files must be set in these are not already in the compile/link path e.g.

CPPFLAGS="-I<atlasdir>/include" LDFLAGS="-L<atlasdir>/lib/<arch>" ./configure

where <atlasdir> is the location of the ATLAS root directory and
<arch> is the "architecture" for which ATLAS has been configured.
If the library has been compiled with ATLAS, then all programs 
that use the library must be compiled with ATLAS.


"--with-acml" ACML is an alternative to ATLAS for AMD-based processors.
Same considerations as --with-atlas (except it is not enabled by default)


"--with-threads" enables use of multi-threading.  A special version 
of library libcmatrix_r.a must be compiled, together with appropriate
options when compiling (see Makefile_template).  NB. Multi-threading
is not being actively developed/verified.  MPI (see below) is
a simpler option in most cases.

"--with-MPI" enables use of the Message Passing Interface (MPI).
mpi.h and -lmpi must be accessible for this to work.

"--with-minuit" enables Minuit support.  If --with or --without is not set explicitly, it is automatically included if the appropriate files are found. 

The configuration script first checks for the current API (Minuit2) but will work with the older C++ Minuit API if found.

Check the configuration options in config.h but be sure you know what you are doing before changing anything!

Note that you can recreate the Makefile's etc. after edits of say config.h without re-running configure by running config.status.

2. make libmatrix.a 
will create the libcmatrix.a library.

or use make all to make all versions of the library e.g. libcmatrix_r.a variant which should be used for multi-threading programs.  Other variants exist for debugging (-g) and profiling (-pg).  


If only compiling libcmatrix for linking with other programs such as pNMRsim, stop here.

No install script is currently supplied since libcmatrix is often only temporarily required for pNMRsim compilation.  If preferred, however, the contents of lib and include can be installed in say /usr/local.


3. Testing
'make all' in the test subdirectory which will create a set of test programs.
These are mostly demonstrations of different aspects of the library rather than real stress tests.  Many programs require input; comments in the .cc
files should give suitable values.  Don't worry if not all the programs compile - the libcmatrix API currently evolves for best interaction with pNMRsim and so the "standalone" interface is not so well defined.

It is a good idea to check the performance of key operations
such a matrix multiplication to ensure that appropriate "tuning"
options have been selected.  The "testops" programs determines
the floating point "throughput" (in megaflops/s) of various
operations as a function of matrix size.  The peak performance
should be of the same order as the CPU clock speed.


4. Read the documentation in docs!

paul.hodgkinson@durham.ac.uk



*** Info below is old and may have lost any relevance ***

There appears to be an error in the header files
supplied with g++ (< V3?) which means that necessary features of the ANSI library
are disabled...  Fixing this requires modifying the stl_config.h file which
configures the STL for g++ - not something you should not do lightly...
Around line 164, comment out the line
#define __STL_NO_NAMESPACES

Sun Workshop/Forte CC: -fast -xO4 -fsimple=1  [ N.B. The aggressive -fsimple=2 can
upset some delicate algorithms ]  [ Compatibility of the current release and the the Sun compilers hasn't been tested. ]

Note that for optimal performance using gcc on the Sun, you need to tell configure
where to find the fast and sunmath (for sincos) libraries.  Search for sunmath.h
and libsunmath.a in the /opt/SUNWspro heirarchy (assuming you have the Sun compilers!).
Then add "-I/opt/SUNWspro/<include dir>" to CPPFLAGS and  "-L/opt/SUNWspro/<library dir>" to LDFLAGS before running configure.

